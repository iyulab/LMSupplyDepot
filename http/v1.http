# ### V1 API Tests (OpenAI Compatible)
@baseUrl = http://localhost:5181

# Filer Proxy
# @baseUrl = http://localhost:12100
# @baseUrl = http://localhost:27010/lm

@model = hf:bartowski/microsoft_Phi-4-mini-instruct-GGUF/microsoft_Phi-4-mini-instruct-Q8_0
@alias = phi

### Get All Models
GET {{baseUrl}}/api/models

### Load model for testing
POST {{baseUrl}}/api/models/load
Content-Type: application/json

{
  "model": "{{alias}}"
}

### unload
POST {{baseUrl}}/api/models/unload
Content-Type: application/json

{
  "model": "{{model}}"
}


### Set alias for easier testing
PUT {{baseUrl}}/api/alias
Content-Type: application/json

{
  "name": "{{model}}",
  "alias": "{{alias}}"
}

# ===========================================
# OpenAI V1 API Tests
# ===========================================

### 1. List Models (OpenAI Compatible)
GET {{baseUrl}}/v1/models
Accept: application/json

#### Expected Response Structure:
# {
#   "object": "list",
#   "data": [
#     {
#       "id": "alias13",
#       "object": "model", 
#       "created": 1753052232,
#       "owned_by": "local",
#       "type": "text-generation"
#     }
#   ]
# }

### 2. Chat Completions - Basic Request
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{model}}",
  "messages": [
    {
      "role": "user",
      "content": "What is the capital of France?"
    }
  ],
  "max_completion_tokens": 50,
  "temperature": 0.7,
  "top_p": 0.95,
  "stream": false
}

#### Expected Response Structure:
# {
#   "id": "chatcmpl-xxx",
#   "object": "chat.completion",
#   "created": 1753061806,
#   "model": "alias13",
#   "choices": [
#     {
#       "index": 0,
#       "message": {
#         "role": "assistant",
#         "content": "Paris is the capital of France..."
#       },
#       "finish_reason": "stop"
#     }
#   ],
#   "usage": {
#     "prompt_tokens": 12,
#     "completion_tokens": 31,
#     "total_tokens": 43
#   }
# }

### 3. Chat Completions - Multi-turn Conversation
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "system",
      "content": "You are a helpful assistant that answers questions about geography."
    },
    {
      "role": "user",
      "content": "What is the capital of France?"
    },
    {
      "role": "assistant", 
      "content": "The capital of France is Paris."
    },
    {
      "role": "user",
      "content": "What about Germany?"
    }
  ],
  "max_completion_tokens": 30,
  "temperature": 0.5
}

### 4. Chat Completions - With Stop Sequences
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Count from 1 to 10:"
    }
  ],
  "max_completion_tokens": 100,
  "temperature": 0.1,
  "stop": ["\n", "5"]
}

### 5. Chat Completions - Streaming (SSE)
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Tell me a short story about a robot."
    }
  ],
  "max_completion_tokens": 100,
  "temperature": 0.8,
  "stream": true
}

#### Expected Streaming Response:
# data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1753061806,"model":"alias13","choices":[{"index":0,"delta":{"content":"Once"},"finish_reason":null}]}
# data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1753061806,"model":"alias13","choices":[{"index":0,"delta":{"content":" upon"},"finish_reason":null}]}
# ...
# data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1753061806,"model":"alias13","choices":[{"index":0,"delta":{},"finish_reason":"stop"}]}
# data: [DONE]

### 6. Embeddings - Single Text
POST {{baseUrl}}/v1/embeddings
Content-Type: application/json

{
  "model": "{{alias}}",
  "input": "Hello, how are you today?"
}

#### Expected Response Structure:
# {
#   "object": "list",
#   "data": [
#     {
#       "object": "embedding",
#       "index": 0,
#       "embedding": [0.1, 0.2, 0.3, ...]
#     }
#   ],
#   "model": "alias13",
#   "usage": {
#     "prompt_tokens": 6,
#     "total_tokens": 6
#   }
# }

### 7. Embeddings - Multiple Texts
POST {{baseUrl}}/v1/embeddings
Content-Type: application/json

{
  "model": "{{alias}}",
  "input": [
    "Hello world",
    "Goodbye world",
    "How are you?"
  ]
}

# ===========================================
# Error Handling Tests (Updated for New Spec)
# ===========================================

### 24. Error - Missing Model Parameter
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "messages": [
    {
      "role": "user",
      "content": "Test"
    }
  ]
}

#### Expected Error Response:
# {
#   "error": {
#     "message": "Model is required",
#     "type": "invalid_request_error",
#     "param": "model"
#   }
# }

### 25. Error - Empty Messages Array
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": []
}

### 26. Error - Invalid Temperature Range
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Test"
    }
  ],
  "temperature": 3.0
}

### 27. Error - Invalid Top-p Range
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Test"
    }
  ],
  "top_p": 1.5
}

### 28. Error - Invalid Max Completion Tokens
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Test"
    }
  ],
  "max_completion_tokens": -1
}

### 29. Error - Invalid Message Role
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "invalid_role",
      "content": "Test"
    }
  ]
}

### 30. Error - Tool Message Without Tool Call ID
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "tool",
      "content": "Function result"
    }
  ]
}

### 31. Error - Non-existent Model
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "non-existent-model",
  "messages": [
    {
      "role": "user", 
      "content": "Test"
    }
  ]
}

### 32. Error - Model Not Loaded
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Test"
    }
  ]
}

### 33. Error - Missing Input for Embeddings
POST {{baseUrl}}/v1/embeddings
Content-Type: application/json

{
  "model": "{{alias}}"
}

# ===========================================
# Tool Calling Tests (OpenAI Compatible)
# ===========================================

### Check if model is loaded before tool testing
GET {{baseUrl}}/api/models/loaded

### 34a. Chat Completions - Tool Calling REQUIRED (Force Tool Use)
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Get weather for Tokyo"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get the current weather in a given location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and country, e.g. San Francisco, CA"
            },
            "unit": {
              "type": "string",
              "enum": ["celsius", "fahrenheit"],
              "description": "The temperature unit"
            }
          },
          "required": ["location"]
        }
      }
    }
  ],
  "tool_choice": "required",
  "max_completion_tokens": 150
}

#### Expected Response with Forced Tool Call:
# {
#   "id": "chatcmpl-xxx",
#   "object": "chat.completion",
#   "created": 1753061806,
#   "model": "alias13",
#   "choices": [
#     {
#       "index": 0,
#       "message": {
#         "role": "assistant",
#         "content": null,
#         "tool_calls": [
#           {
#             "id": "call_xxx",
#             "type": "function",
#             "function": {
#               "name": "get_weather",
#               "arguments": "{\"location\":\"Tokyo, Japan\",\"unit\":\"celsius\"}"
#             }
#           }
#         ]
#       },
#       "finish_reason": "tool_calls"
#     }
#   ],
#   "usage": {
#     "prompt_tokens": 25,
#     "completion_tokens": 28,
#     "total_tokens": 53
#   }
# }

### 34c. Chat Completions - Tool Calling REQUIRED (Math Calculation)
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Calculate 25 + 17"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "calculate",
        "description": "Perform basic mathematical calculations",
        "parameters": {
          "type": "object",
          "properties": {
            "operation": {
              "type": "string",
              "enum": ["add", "subtract", "multiply", "divide"]
            },
            "a": {
              "type": "number",
              "description": "First number"
            },
            "b": {
              "type": "number",
              "description": "Second number"
            }
          },
          "required": ["operation", "a", "b"]
        }
      }
    }
  ],
  "tool_choice": "required",
  "max_completion_tokens": 100
}

#### Expected Response with Math Tool Call:
# {
#   "id": "chatcmpl-xxx",
#   "object": "chat.completion",
#   "created": 1753061806,
#   "model": "alias13",
#   "choices": [
#     {
#       "index": 0,
#       "message": {
#         "role": "assistant",
#         "content": null,
#         "tool_calls": [
#           {
#             "id": "call_xxx",
#             "type": "function",
#             "function": {
#               "name": "calculate",
#               "arguments": "{\"operation\":\"add\",\"a\":25,\"b\":17}"
#             }
#           }
#         ]
#       },
#       "finish_reason": "tool_calls"
#     }
#   ]
# }

### 34b. Chat Completions - Tool Calling with Direct Instruction
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "system",
      "content": "You are a helpful assistant. When users ask about weather, you must use the get_weather function. Format your tool calls as: <tool_call>{\"name\": \"function_name\", \"parameters\": {\"key\": \"value\"}}</tool_call>"
    },
    {
      "role": "user",
      "content": "What's the weather in Tokyo?"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get the current weather in a given location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and country, e.g. San Francisco, CA"
            }
          },
          "required": ["location"]
        }
      }
    }
  ],
  "tool_choice": "auto",
  "max_completion_tokens": 150
}

### 34. Chat Completions - Tool Calling with Function
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "I need to check the weather in Tokyo. Please use the get_weather function to get this information."
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get the current weather in a given location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and country, e.g. San Francisco, CA"
            },
            "unit": {
              "type": "string",
              "enum": ["celsius", "fahrenheit"],
              "description": "The temperature unit"
            }
          },
          "required": ["location"]
        }
      }
    }
  ],
  "tool_choice": "auto",
  "max_completion_tokens": 150
}

#### Expected Response with Tool Call:
# {
#   "id": "chatcmpl-xxx",
#   "object": "chat.completion",
#   "created": 1753061806,
#   "model": "alias13",
#   "choices": [
#     {
#       "index": 0,
#       "message": {
#         "role": "assistant",
#         "content": null,
#         "tool_calls": [
#           {
#             "id": "call_xxx",
#             "type": "function",
#             "function": {
#               "name": "get_weather",
#               "arguments": "{\"location\": \"Tokyo, Japan\", \"unit\": \"celsius\"}"
#             }
#           }
#         ]
#       },
#       "finish_reason": "tool_calls"
#     }
#   ],
#   "usage": {
#     "prompt_tokens": 25,
#     "completion_tokens": 28,
#     "total_tokens": 53
#   }
# }

### 35. Chat Completions - Tool Choice Required
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{model}}",
  "messages": [
    {
      "role": "user",
      "content": "Calculate 15 + 27"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "calculate",
        "description": "Perform basic mathematical calculations",
        "parameters": {
          "type": "object",
          "properties": {
            "operation": {
              "type": "string",
              "enum": ["add", "subtract", "multiply", "divide"]
            },
            "a": {
              "type": "number",
              "description": "First number"
            },
            "b": {
              "type": "number",
              "description": "Second number"
            }
          },
          "required": ["operation", "a", "b"]
        }
      }
    }
  ],
  "tool_choice": "required",
  "max_completion_tokens": 100
}

### 36. Chat Completions - Specific Tool Choice
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Send an email to john@example.com"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "send_email",
        "description": "Send an email to a recipient",
        "parameters": {
          "type": "object",
          "properties": {
            "to": {
              "type": "string",
              "description": "Email address of the recipient"
            },
            "subject": {
              "type": "string",
              "description": "Subject of the email"
            },
            "body": {
              "type": "string",
              "description": "Body content of the email"
            }
          },
          "required": ["to", "subject", "body"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get weather information",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string"
            }
          },
          "required": ["location"]
        }
      }
    }
  ],
  "tool_choice": {
    "type": "function",
    "function": {
      "name": "send_email"
    }
  },
  "max_completion_tokens": 100
}

### 37. Chat Completions - Tool Choice None
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Just tell me a joke, don't use any tools"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_joke",
        "description": "Get a random joke",
        "parameters": {
          "type": "object",
          "properties": {
            "category": {
              "type": "string",
              "description": "Category of joke"
            }
          }
        }
      }
    }
  ],
  "tool_choice": "none",
  "max_completion_tokens": 100
}

### 38. Chat Completions - Streaming with Tool Calls
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "What's the current time in New York?"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_current_time",
        "description": "Get the current time in a specific timezone",
        "parameters": {
          "type": "object",
          "properties": {
            "timezone": {
              "type": "string",
              "description": "The timezone, e.g. America/New_York"
            }
          },
          "required": ["timezone"]
        }
      }
    }
  ],
  "tool_choice": "auto",
  "stream": true,
  "max_completion_tokens": 100
}

#### Expected Streaming Response with Tool Calls:
# data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1753061806,"model":"alias13","choices":[{"index":0,"delta":{"content":"I'll"},"finish_reason":null}]}
# data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1753061806,"model":"alias13","choices":[{"index":0,"delta":{"content":" check"},"finish_reason":null}]}
# ...
# data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1753061806,"model":"alias13","choices":[{"index":0,"delta":{"tool_calls":[{"index":0,"id":"call_xxx","type":"function","function":{"name":"get_current_time","arguments":"{\"timezone\": \"America/New_York\"}"}}]},"finish_reason":null}]}
# data: {"id":"chatcmpl-xxx","object":"chat.completion.chunk","created":1753061806,"model":"alias13","choices":[{"index":0,"delta":{},"finish_reason":"tool_calls"}]}
# data: [DONE]

### 39. Chat Completions - Multiple Tool Calls
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Get the weather in Tokyo and New York, and also calculate 25 * 4"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get weather information",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string"
            }
          },
          "required": ["location"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "calculate",
        "description": "Perform mathematical calculations",
        "parameters": {
          "type": "object",
          "properties": {
            "operation": {
              "type": "string",
              "enum": ["add", "subtract", "multiply", "divide"]
            },
            "a": {
              "type": "number"
            },
            "b": {
              "type": "number"
            }
          },
          "required": ["operation", "a", "b"]
        }
      }
    }
  ],
  "tool_choice": "auto",
  "parallel_tool_calls": true,
  "max_completion_tokens": 200
}

# ===========================================
# Finish Reason Tests (Enhanced Coverage)
# ===========================================

### 40. Chat Completions - Stop Reason (Natural End)
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Say hello."
    }
  ],
  "max_completion_tokens": 1000,
  "temperature": 0.3
}

#### Expected finish_reason: "stop"

### 41. Chat Completions - Length Reason (Token Limit)
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Write a very long story about a magical kingdom with many characters and adventures."
    }
  ],
  "max_completion_tokens": 10,
  "temperature": 0.5
}

#### Expected finish_reason: "length"

### 42. Chat Completions - Stop Sequence Triggered
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Count from 1 to 10: 1, 2, 3"
    }
  ],
  "max_completion_tokens": 100,
  "temperature": 0.1,
  "stop": [", 5", "END"]
}

#### Expected finish_reason: "stop" (when stop sequence is hit)

### 43. Chat Completions - Streaming Length Limit
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Tell me a detailed story about space exploration."
    }
  ],
  "max_completion_tokens": 5,
  "temperature": 0.7,
  "stream": true
}

#### Expected streaming finish_reason: "length"

### 44. Chat Completions - Content Filter Test
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "I cannot provide that information as it violates content policy."
    }
  ],
  "max_completion_tokens": 100,
  "temperature": 0.5
}

#### Expected finish_reason: "content_filter" (if content filtering is detected)

# ===========================================
# Tool Calling Error Tests
# ===========================================

### 45. Error - Invalid Tool Choice Type
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Test message"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "test_function",
        "description": "A test function"
      }
    }
  ],
  "tool_choice": "invalid_choice"
}

#### Expected Error Response:
# {
#   "error": {
#     "message": "Invalid tool_choice type 'invalid_choice'. Must be one of: auto, none, required",
#     "type": "invalid_request_error",
#     "param": "tool_choice"
#   }
# }

### 46. Error - Tool Choice Without Tools
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Test message"
    }
  ],
  "tool_choice": "auto"
}

#### Expected Error Response:
# {
#   "error": {
#     "message": "tool_choice requires tools to be specified",
#     "type": "invalid_request_error",
#     "param": "tool_choice"
#   }
# }

### 47. Error - Function Not Found in Tools
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{model}}",
  "messages": [
    {
      "role": "user",
      "content": "Test message"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "existing_function",
        "description": "An existing function"
      }
    }
  ],
  "tool_choice": {
    "type": "function",
    "function": {
      "name": "non_existent_function"
    }
  }
}

#### Expected Error Response:
# {
#   "error": {
#     "message": "tool_choice function 'non_existent_function' not found in available tools",
#     "type": "invalid_request_error",
#     "param": "tool_choice"
#   }
# }

### 48. Error - Invalid Tool Type
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Test message"
    }
  ],
  "tools": [
    {
      "type": "invalid_type",
      "function": {
        "name": "test_function",
        "description": "A test function"
      }
    }
  ]
}

#### Expected Error Response:
# {
#   "error": {
#     "message": "Only 'function' type tools are supported",
#     "type": "invalid_request_error",
#     "param": "tools"
#   }
# }

### 49. Error - Invalid Function Name Format
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{model}}",
  "messages": [
    {
      "role": "user",
      "content": "Test message"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "invalid function name!",
        "description": "A function with invalid name"
      }
    }
  ]
}

#### Expected Error Response:
# {
#   "error": {
#     "message": "Tool function names must contain only letters, numbers, underscores, and dashes",
#     "type": "invalid_request_error",
#     "param": "tools"
#   }
# }

# ===========================================
# Performance and Edge Case Tests (Updated)
# ===========================================

### 13. Chat Completions - Maximum Tokens
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Write a detailed explanation of quantum computing."
    }
  ],
  "max_completion_tokens": 1000,
  "temperature": 0.3
}

### 14. Chat Completions - High Temperature (Creative)
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Create a creative poem about AI."
    }
  ],
  "max_completion_tokens": 200,
  "temperature": 1.5,
  "top_p": 0.9
}

### 15. Chat Completions - Low Temperature (Deterministic)
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{model}}",
  "messages": [
    {
      "role": "user",
      "content": "What is 2 + 2?"
    }
  ],
  "max_completion_tokens": 10,
  "temperature": 0.0,
  "top_p": 1.0
}

### 16. Embeddings - Long Text
POST {{baseUrl}}/v1/embeddings
Content-Type: application/json

{
  "model": "{{alias}}",
  "input": "This is a very long text that should test the embedding capabilities of the model. It contains multiple sentences and should provide a good test case for embedding generation. The text covers various topics and should result in a meaningful vector representation that captures the semantic content of the entire passage."
}

### 17. Chat Completions - Developer Role (New)
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "developer",
      "content": "You are a coding assistant that helps with Python programming."
    },
    {
      "role": "user",
      "content": "Write a function to calculate factorial."
    }
  ],
  "max_completion_tokens": 150,
  "temperature": 0.3
}

### 18. Chat Completions - With Seed for Deterministic Output
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{model}}",
  "messages": [
    {
      "role": "user",
      "content": "Generate a random story idea."
    }
  ],
  "max_completion_tokens": 100,
  "temperature": 0.8,
  "seed": 42
}

### 19. Chat Completions - With Logit Bias
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{model}}",
  "messages": [
    {
      "role": "user",
      "content": "Tell me about cats and dogs."
    }
  ],
  "max_completion_tokens": 50,
  "temperature": 0.5,
  "logit_bias": {
    "2047": 10,
    "1867": -10
  }
}

### 20. Chat Completions - With Stream Options
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Explain artificial intelligence."
    }
  ],
  "max_completion_tokens": 200,
  "temperature": 0.7,
  "stream": true,
  "stream_options": {
    "include_usage": true
  }
}

### 21. Chat Completions - With Frequency and Presence Penalties
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Write about the benefits of exercise."
    }
  ],
  "max_completion_tokens": 150,
  "temperature": 0.7,
  "frequency_penalty": 0.5,
  "presence_penalty": 0.3
}

### 22. Chat Completions - Multiple Choices (n parameter)
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "What's a good name for a pet cat?"
    }
  ],
  "max_completion_tokens": 20,
  "temperature": 0.9,
  "n": 3
}

### 23. Chat Completions - With User ID for Safety
POST {{baseUrl}}/v1/chat/completions
Content-Type: application/json

{
  "model": "{{alias}}",
  "messages": [
    {
      "role": "user",
      "content": "Help me with my homework."
    }
  ],
  "max_completion_tokens": 100,
  "temperature": 0.5,
  "user": "user123"
}

# ===========================================
# CLEANUP: Unload Model After Testing
# ===========================================

### Unload model after testing
POST {{baseUrl}}/api/models/unload
Content-Type: application/json

{
  "model": "{{alias}}"
}
